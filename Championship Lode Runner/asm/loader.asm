; --------------------------------------------------------------------------------------------------------------------- ;
;  Championship Lode Runner - loader.prg
; --------------------------------------------------------------------------------------------------------------------- ;
                            * = $0400
; --------------------------------------------------------------------------------------------------------------------- ;
; compiler settings
; --------------------------------------------------------------------------------------------------------------------- ;
                            .cpu "6502"                     ; standard 65xx processor
                            
MemoryLayout                .include "../../inc/c64.MEM.asm" ; Memory layout
; --------------------------------------------------------------------------------------------------------------------- ;
                            
; ´ ------------------------------------------------------------------------------------------------------------------- ;
; Loader                    Does    : load all the required files
;                           Expects : 
;                           Returns : 
; --------------------------------------------------------------------------------------------------------------------- ;
Loader                     .block                           ; 
                            jsr LoadFiles                   ; it
; --------------------------------------------------------------------------------------------------------------------- ;
; set the db filename
; --------------------------------------------------------------------------------------------------------------------- ;
                            lda #"d"                        ; 
                            sta Filname_Char_01             ; 
                            lda #"b"                        ; 
                            sta Filname_Char_02             ; 
                            jsr LoadFiles                   ; 
; --------------------------------------------------------------------------------------------------------------------- ;
; call the main programs entry point
; --------------------------------------------------------------------------------------------------------------------- ;
                            jmp $6000                       ; 
                           .bend                            ; 
; ` ------------------------------------------------------------------------------------------------------------------- ;
                            
; ´ ------------------------------------------------------------------------------------------------------------------- ;
; LoadFiles                 Does    : load a given file
;                           Expects : 
;                           Returns : 
; --------------------------------------------------------------------------------------------------------------------- ;
LoadFiles                  .block                           ; 
; --------------------------------------------------------------------------------------------------------------------- ;
; open the required channel
; --------------------------------------------------------------------------------------------------------------------- ;
                            lda #$01                        ; channel number
                            ldx #$08                        ; drive
                            ldy #KV_SETLFS_SA_NONE          ; no secondary address to be used
                            jsr SETLFS                      ; Kernal($FFBA) Set logical file parameters ($FE00)
                            jsr OPEN                        ; Kernal($FFC0) Open a logical file (via $31A to $F34A)
; --------------------------------------------------------------------------------------------------------------------- ;
; set the file name
; --------------------------------------------------------------------------------------------------------------------- ;
                            lda #Filname_Len                ; 
                            ldx #<Filname                   ; 
                            ldy #>Filname                   ; 
                            jsr SETNAM                      ; Kernal($FFBD) Set filename parameters ($FDF9)
; --------------------------------------------------------------------------------------------------------------------- ;
; load the file
; --------------------------------------------------------------------------------------------------------------------- ;
                            lda #KV_LOAD_LOAD               ; flag: load
                            jsr LOAD                        ; Kernal($FFD5) Load from device (via $330 to $F49E)
; --------------------------------------------------------------------------------------------------------------------- ;
; close the channel
; --------------------------------------------------------------------------------------------------------------------- ;
                            jsr CLALL                       ; Kernal($FFE7) Close all files (via $32C to $F32F)
                            
                            rts                             ; 
                           .bend                            ; 
; ` ------------------------------------------------------------------------------------------------------------------- ;
                            
; --------------------------------------------------------------------------------------------------------------------- ;
Filname                     = *          ; 
Filname_Char_01             .byte "i"    ; 
Filname_Char_02             .byte "t"    ; 
Filname_Len                 = * -Filname ; 
; --------------------------------------------------------------------------------------------------------------------- ;
